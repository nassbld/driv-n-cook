<div class="dashboard-header">
  <h1>Gestion des Entrepôts et des Stocks</h1>
</div>

<div class="management-layout">
  <!-- Colonne de gauche : Liste des entrepôts -->
  <div class="warehouse-list card">
    <h2>Entrepôts</h2>
    @if(warehouses$ | async; as warehouses) {
      <ul>
        @for(warehouse of warehouses; track warehouse.id) {
          <li (click)="selectWarehouse(warehouse)"
              [class.active]="selectedWarehouse()?.id === warehouse.id">
            {{ warehouse.name }}
          </li>
        }
      </ul>
    }
  </div>

  <!-- Colonne de droite : Détails et stock de l'entrepôt sélectionné -->
  <div class="inventory-details card">
    @if(selectedWarehouse(); as warehouse) {
      <div class="details-header"> <!-- Nouveau conteneur pour le titre et le bouton -->
        <h2>Stock de : {{ warehouse.name }}</h2>
        <button class="add-button" (click)="openAddToInventoryModal()">+ Ajouter au stock</button>
      </div>
      <div class="table-container">
        @if(inventory$ | async; as inventory) {
          <table>
            <thead>
            <tr>
              <th>Produit</th>
              <th>Stock Actuel</th>
              <th>Actions</th>
            </tr>
            </thead>
            <tbody>
              @for(item of inventory; track item.id) {
                <tr>
                  <td>{{ item.productName }}</td>
                  <td>{{ item.stock }}</td>
                  <td><button class="action-button view" (click)="openManageStockModal(item)">Modifier</button></td>
                </tr>
              } @empty {
                <tr><td colspan="3" class="empty-state">Aucun stock défini pour cet entrepôt.</td></tr>
              }
            </tbody>
          </table>
        }
      </div>
    } @else {
      <p class="empty-state">Veuillez sélectionner un entrepôt pour voir les stocks.</p>
    }
  </div>
</div>

@if(isManageStockModalOpen() && itemToManage()) {
  <app-manage-stock-modal [item]="itemToManage()!" (close)="isManageStockModalOpen.set(false)"></app-manage-stock-modal>
}

@if(isAddToInventoryModalOpen() && selectedWarehouse()) {
  <app-add-to-inventory-modal [warehouse]="selectedWarehouse()!" (close)="isAddToInventoryModalOpen.set(false)"></app-add-to-inventory-modal>
}
